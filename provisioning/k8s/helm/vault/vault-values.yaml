# Vault Helm values for k3s: single replica, file storage (PVC), no Agent Injector.
# Install: helm repo add hashicorp https://helm.releases.hashicorp.com && helm install vault hashicorp/vault -n vault -f helm/vault/vault-values.yaml
# Requires: kubectl create namespace vault

global:
  enabled: true
  tlsDisable: true

# Do NOT use Vault Agent Injector (we use External Secrets Operator only).
injector:
  enabled: false

# Single Vault server. Data persists in PVC (file storage; for Raft use server.ha.raft with replicas: 1).
server:
  enabled: true
  replicas: 1
  image:
    repository: hashicorp/vault
    tag: "1.21.2"
    pullPolicy: IfNotPresent

  standalone:
    enabled: true
    config: |
      ui = true
      listener "tcp" {
        tls_disable       = 1
        address          = "[::]:8200"
        cluster_address  = "[::]:8201"
      }
      storage "file" {
        path = "/vault/data"
      }
      service_registration "kubernetes" {}

  # PVC for Vault data (required for persistence).
  dataStorage:
    enabled: true
    size: 10Gi
    mountPath: "/vault/data"
    storageClass: null  # use cluster default (e.g. local-path on k3s)

  # Allow single-node; no anti-affinity.
  affinity: []

  # authDelegator lets this SA be used for Kubernetes auth method setup.
  authDelegator:
    enabled: true

  # Service: ClusterIP so ESO in cluster can reach http://vault.vault.svc:8200
  service:
    enabled: true
    port: 8200
