# Example: sync Docker registry credentials from Vault into a K8s Secret of type kubernetes.io/dockerconfigjson.
# ServiceAccount can reference this secret in imagePullSecrets (e.g. default-serviceaccount.yaml).
# In Vault, store at secret/data/default/registry with key .dockerconfigjson (value: {"auths":{"cr.yandex":{"username":"...","password":"...","auth":"..."}}}).
{{- if .Values.externalSecrets.enabled }}
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: ycr-pull
  namespace: {{ .Release.Namespace }}
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: vault
    kind: ClusterSecretStore
  target:
    name: ycr-pull
    creationPolicy: Owner
    template:
      type: kubernetes.io/dockerconfigjson
  data:
    - secretKey: .dockerconfigjson
      remoteRef:
        key: {{ .Values.externalSecrets.vaultPathRegistry }}
        property: .dockerconfigjson
{{- end }}
